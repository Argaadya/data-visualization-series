destination = c("end_long", "end_lat"),
tooltip = "individual_local_identifier",
stroke_from = "individual_local_identifier",
stroke_to = "individual_local_identifier",
layer_id = 'arclayer'
)
table(movement_data$individual_local_identifier)
n_distinct(movement_data$individual_local_identifier)
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat)
) %>%
ungroup() %>%
na.omit()
head(movement_data, 10)
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup() %>%
na.omit()
head(movement_data, 10)
library(highchart)
library(highcharter)
movement_data %>%
group_by(animal_life_stage)
movement_data %>%
group_by(animal_life_stage) %>%
nrow()
movement_data %>%
group_by(animal_life_stage) %>%
count(event_id)
movement_data %>%
group_by(animal_life_stage) %>%
count(individual_local_identifier)
n_distinct(movement_data$individual_local_identifier)
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup() %>%
na.omit()
head(movement_data, 10)
n_distinct(movement_data$individual_local_identifier)
n_distinct(df_join$individual_local_identifier)
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup() %>%
na.omit()
n_distinct(movement_data$individual_local_identifier)
df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp)
df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup()
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup()
n_distinct(movement_data$individual_local_identifier)
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup() %>%
na.omit()
n_distinct(movement_data$individual_local_identifier)
df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup()
movement_data <- df_join %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = sqrt((start_long - end_long)^2 + (start_lat - end_lat)^2)
) %>%
ungroup() %>%
drop_na(timestamp, end_lat, end_long)
head(movement_data, 10)
n_distinct(movement_data$individual_local_identifier)
movement_data %>%
group_by(timestamp) %>%
count(event_id)
library(lubridate)
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
count(event_id)
movement_data %>%
mutate(date = date(timestamp)) %>%
count(date, animal_life_stage)
movement_data %>%
mutate(date = date(timestamp)) %>%
count(date, animal_life_stage) %>%
ggplot(aes(date, n, fill = animal_life_stage)) +
geom_line()
movement_data %>%
mutate(date = date(timestamp)) %>%
count(date, animal_life_stage) %>%
ggplot(aes(date, n, color = animal_life_stage)) +
geom_line()
movement_data
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = mean(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line()
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = mean(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line()
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line()
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal()
pi
convert_distance <- function(lat1, lat2, lon1, lon2){
# Radius of Earth in km
rad_earth <- 6378.137
dlat <- lat2 * pi / 180 - lat1 * pi / 180
dlon <- lon2 * pi / 180 - lon1 * pi / 180
a <- (sin(dlat/2))^2 + (cos(lat1 * pi / 180))^2 * (sin(dlon/2))^2
c <- 2 * atan2(sqrt(a), sqrt(1-a))
d <- rad_earth * c * 1000
return(d)
}
movement_data
movement_data %>%
select(start_lat, end_lat, start_long, end_long)
movement_data %>%
select(start_lat, end_lat, start_long, end_long) %>%
mutate(
distance = convert_distance(start_lat, end_lat, start_long, end_long)
)
convert_distance <- function(lat1, lat2, lon1, lon2){
# Radius of Earth in km
rad_earth <- 6378.137
dlat <- lat2 * pi / 180 - lat1 * pi / 180
dlon <- lon2 * pi / 180 - lon1 * pi / 180
a <- (sin(dlat/2))^2 + (cos(lat1 * pi / 180))^2 * (sin(dlon/2))^2
c <- 2 * atan2(sqrt(a), sqrt(1-a))
d <- rad_earth * c
return(d)
}
movement_data %>%
select(start_lat, end_lat, start_long, end_long) %>%
mutate(
distance = convert_distance(start_lat, end_lat, start_long, end_long)
)
convert_distance <- function(lat1, lat2, lon1, lon2){
# Radius of Earth in km
rad_earth <- 6378.137
dlat <- lat2 * pi / 180 - lat1 * pi / 180
dlon <- lon2 * pi / 180 - lon1 * pi / 180
a <- (sin(dlat/2))^2 + (cos(lat1 * pi / 180))^2 * (sin(dlon/2))^2
c <- 2 * atan2(sqrt(a), sqrt(1-a))
d <- rad_earth * c * 1000
return(d)
}
movement_data %>%
select(start_lat, end_lat, start_long, end_long) %>%
mutate(
distance = convert_distance(start_lat, end_lat, start_long, end_long)
)
movement_data <- movement_data %>%
mutate(
distance = convert_distance(start_lat, end_lat, start_long, end_long)
)
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal()
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal()
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal()
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "3 months")
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months")
movement_data %>%
mutate(date = date(timestamp)) %>%
group_by(date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months",date_labels = strftime(date, format = "%Y-%m"))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months", date_labels = strftime(stamp_date, format = "%Y-%m"))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months", date_labels = strftime(as.character(stamp_date), format = "%Y-%m"))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months", date_labels = strftime(stamp_date, format = "%Y-%m"))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%Y-%m"))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%Y-%m")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
convert_distance <- function(lat1, lat2, lon1, lon2){
# Radius of Earth in km
rad_earth <- 6378.137
dlat <- lat2 * pi / 180 - lat1 * pi / 180
dlon <- lon2 * pi / 180 - lon1 * pi / 180
a <- (sin(dlat/2))^2 + (cos(lat1 * pi / 180))^2 * (sin(dlon/2))^2
c <- 2 * atan2(sqrt(a), sqrt(1-a))
d <- rad_earth * c
return(d)
}
movement_data <- movement_data %>%
mutate(
distance = convert_distance(start_lat, end_lat, start_long, end_long)
)
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%Y-%m")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%Y-%m")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%Y-%B")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%B-%y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%b-%y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "6 months", labels = scales::date_format(format = "%b-%Y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "1 year", labels = scales::date_format(format = "%Y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
df_gps <- df_gps %>%
left_join(df_ref, by = c("tag_local_identifier" = "tag_id", "individual_local_identifier" = "animal_id"))
glimpse(df_gps)
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, study_site) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = study_site)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "1 year", labels = scales::date_format(format = "%Y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, distance, color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "1 year", labels = scales::date_format(format = "%Y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
ggplot(aes(stamp_date, log(distance), color = animal_life_stage)) +
geom_line() +
theme_minimal() +
theme(legend.position = "top") +
scale_x_date(date_breaks = "1 year", labels = scales::date_format(format = "%Y")) +
scale_y_continuous(labels = scales::number_format(big.mark = ","))
exp(-3)
exp(0)
log(1)
time_movement <- movement_data %>%
mutate(stamp_date = date(timestamp)) %>%
group_by(stamp_date, animal_life_stage) %>%
summarise(distance = median(distance)) %>%
mutate(
log_distance = log(distance)
)
highchart() %>%
hc_add_series(time_movement, hcaes(x = date, y = log_distance, group = animal_life_stage))
time_movement
highchart() %>%
hc_add_series(time_movement, hcaes(x = stamp_date, y = log_distance, group = animal_life_stage))
time_movement
highchart() %>%
hc_add_series(time_movement, hcaes(x = stamp_date, y = log_distance, group = animal_life_stage))
highchart() %>%
hc_add_series(time_movement, "line", hcaes(x = stamp_date, y = log_distance, group = animal_life_stage))
highchart() %>%
hc_add_series(time_movement, "line", hcaes(x = stamp_date, y = log_distance, group = animal_life_stage)) %>%
hc_theme_monokai()
highchart() %>%
hc_add_series(time_movement, "line", hcaes(x = stamp_date, y = log_distance, group = animal_life_stage)) %>%
hc_add_theme(hc_theme_monokai())
knitr::include_graphics("asset/larus fuscus.jpg")
glimpse(df_ref)
glimpse(df_argos)
df_join_argos <- df_argos %>%
left_join(df_ref, by = c("tag_local_identifier" = "tag_id", "individual_local_identifier" = "animal_id"))
df_join_gps <- df_gps %>%
left_join(df_ref, by = c("tag_local_identifier" = "tag_id", "individual_local_identifier" = "animal_id"))
df_join_argos <- df_argos %>%
left_join(df_ref, by = c("tag_local_identifier" = "tag_id", "individual_local_identifier" = "animal_id"))
convert_distance <- function(lat1, lat2, lon1, lon2){
# Radius of Earth in km
rad_earth <- 6378.137
dlat <- lat2 * pi / 180 - lat1 * pi / 180
dlon <- lon2 * pi / 180 - lon1 * pi / 180
a <- (sin(dlat/2))^2 + (cos(lat1 * pi / 180))^2 * (sin(dlon/2))^2
c <- 2 * atan2(sqrt(a), sqrt(1-a))
d <- rad_earth * c
return(d)
}
movement_data <- df_join_gps %>%
group_by(individual_local_identifier) %>%
arrange(timestamp) %>%
mutate(
start_long = location_long,
end_long = lead(location_long),
start_lat = location_lat,
end_lat = lead(location_lat),
distance = convert_distance(start_lat, end_lat, start_long, end_long)
) %>%
ungroup() %>%
drop_na(timestamp, end_lat, end_long)
head(movement_data, 10)
